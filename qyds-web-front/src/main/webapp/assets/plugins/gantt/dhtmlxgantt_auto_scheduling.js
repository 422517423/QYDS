/*
@license

dhtmlxGantt v.4.0.10 Professional Evaluation
This software is covered by DHTMLX Evaluation License. Contact sales@dhtmlx.com to get Commercial or Enterprise license. Usage without proper license is prohibited.

(c) Dinamenta, UAB.
*/
Gantt.plugin(function(t){t.config.auto_scheduling=!1,t.config.auto_scheduling_descendant_links=!1,t.config.auto_scheduling_initial=!0,t.config.auto_scheduling_strict=!1,function(){var e=t._default_task_date;t._default_task_date=function(i,n){var a=e.apply(t,arguments);if(i.$target&&i.$source){var s=t._getTaskMinimalStartDate(i).date;s&&t._firstSmaller(a,s)&&(a=t.getClosestWorkTime({date:s,dir:"future"}))}return a}}(),t._datesNotEqual=function(t,e){return t.valueOf()>e.valueOf()?this._hasDuration(e,t):this._hasDuration(t,e);
},t._firstSmaller=function(t,e){return t.valueOf()<e.valueOf()&&this._hasDuration(t,e)?!0:!1},t._firstBigger=function(t,e){return this._firstSmaller(e,t)},t._notEqualTaskDates=function(e,i){return this._datesNotEqual(e.start_date,i.start_date)||(this._datesNotEqual(e.end_date,i.end_date)||e.duration!=i.duration)&&e.type!=t.config.types.milestone?!0:void 0},t._autoScheduleHandler=function(e,i,n){if(t.config.auto_scheduling&&!this._autoscheduling_in_progress){var a=this.getTask(e);t._notEqualTaskDates(n,a)&&t.autoSchedule(a.id);
}return!0},t._linkChangeAutoScheduleHandler=function(e,i){t.config.auto_scheduling&&!this._autoscheduling_in_progress&&t.autoSchedule(i.source)},t._autoScheduleOnLoadHandler=function(){t.config.auto_scheduling&&t.config.auto_scheduling_initial&&t.autoSchedule()},t._checkCircularDependency=function(e,i,n){if(n[e.id])return!1;n[e.id]=!0;for(var a,s=0;s<e.$source.length;s++)if(e.$source[s]!=i.id){var r=this.getLink(e.$source[s]);if(a=this._get_link_target(r),a&&!this._checkCircularDependency(a,i,n))return!1;
}if(e.id==i.source&&(a=this._get_link_target(i),a&&!this._checkCircularDependency(a,i,n)))return!1;if(!t.config.auto_scheduling_descendant_links)for(var o=t.getChildren(e.id),s=0;s<o.length;s++){var _=this.getTask(o[s]);if(!_.$target.length&&!this._checkCircularDependency(_,i,n))return!1}return!0},t._checkParents=function(e,i){if(i[e])return!1;if(e!=t.config.root_id){var n=t.getParent(e);if(n!=t.config.root_id)return t._checkParents(n,i)}return!0},t._linkValidationHandler=function(e,i){var n=(t.config.auto_scheduling_descendant_links||!(t.isChildOf(i.target,i.source)||t.isChildOf(i.source,i.target)))&&t._checkCircularDependency(t.getTask(i.source),i,{});
return n||t.callEvent("onCircularLinkError",[i]),n},t._lightBoxChangesHandler=function(e,i){if(t.config.auto_scheduling&&!this._autoscheduling_in_progress){var n=this.getTask(e);t._notEqualTaskDates(i,n)&&(t._autoschedule_lightbox_id=e)}return!0},t._lightBoxSaveHandler=function(e,i){return t.config.auto_scheduling&&!this._autoscheduling_in_progress&&t._autoschedule_lightbox_id&&t._autoschedule_lightbox_id==e&&(t._autoschedule_lightbox_id=null,t.autoSchedule(i.id)),!0},t.attachEvent("onAfterLinkUpdate",t._linkChangeAutoScheduleHandler),
t.attachEvent("onAfterLinkAdd",t._linkChangeAutoScheduleHandler),t.attachEvent("onParse",t._autoScheduleOnLoadHandler),t.attachEvent("onBeforeLinkAdd",t._linkValidationHandler),t.attachEvent("onBeforeLinkUpdate",t._linkValidationHandler),t.attachEvent("onBeforeTaskChanged",t._autoScheduleHandler),t.attachEvent("onLightboxSave",t._lightBoxChangesHandler),t.attachEvent("onAfterTaskUpdate",t._lightBoxSaveHandler),t.autoSchedule=function(e){if(t.callEvent("onBeforeAutoSchedule",[e])!==!1){var i,n={};if(e)i=this.getTask(e),
n=t._autoScheduleByTask(i,n);else for(var a=t.getChildren(t.config.root_id),s=0;s<a.length;s++)i=this.getTask(a[s]),n=t._autoScheduleByTask(i,n);t._updateTasks(n);var r=[];for(var s in n)r.push(s);t.callEvent("onAfterAutoSchedule",[e,r])}},t._autoScheduleByTask=function(e,i){return t.config.auto_scheduling_strict?i=t._autoScheduleLinkedTasks(e,i,null,e.id):(i=t._autoScheduleLinkedTasks(e,i,null),e.parent&&e.parent!=t.config.root_id&&(i=t._autoScheduleParents(this.getTask(e.parent),i))),i},t._autoScheduleLinkedTasks=function(e,i,n,a){
var s;if(void 0===e.auto_scheduling||e.auto_scheduling){var r=t._getTaskMinimalStartDate(e);if(e.parent&&e.parent!=t.config.root_id){var o=this.getTask(e.parent),_=t._getProjectMinimalStartDate(o);r.date&&_.date?this._firstSmaller(r.date,_.date)&&(r=_):r.date||(r=_)}var d=t._isTask(e)&&r.date&&(t.config.auto_scheduling_strict&&this._datesNotEqual(r.date,e.start_date)&&a!=e.id||this._firstBigger(r.date,e.start_date));if(d){if(t.callEvent("onBeforeTaskAutoSchedule",[e,r.date,r.link,r.source_task])===!1)return i;
t._updateTaskPosition(e,r.date,e.duration),i[e.id]=!0}if(!t.config.auto_scheduling_descendant_links){var l=this.getChildren(e.id),h=a&&t.isChildOf(a,e.id);if(l.length&&(!t.config.auto_scheduling_strict||!h||h&&d))for(s=0;s<l.length;s++)t._autoScheduleLinkedTasks(this.getTask(l[s]),i,n,a)}d&&t.callEvent("onAfterTaskAutoSchedule",[e,r.date,r.link,r.source_task])}for(s=0;s<e.$source.length;s++){var c=this.getLink(e.$source[s]),u=this._get_link_target(c);u&&t._autoScheduleLinkedTasks(u,i,n,a)}if(e.parent&&n&&e.parent!=t.config.root_id){
var g=this.getTask(e.parent);t.config.auto_scheduling_strict?t._autoScheduleParents(g,i,a):t._autoScheduleParents(g,i)}return i},t._updateTaskPosition=function(t,e,i){t.start_date=this.getClosestWorkTime({date:e,dir:"future"}),t.end_date=this.calculateEndDate(e,i)},t._updateTasks=function(e){this._autoscheduling_in_progress=!0,t.batchUpdate(function(){for(var i in e)t.updateTask(i)}),this._autoscheduling_in_progress=!1},t._calculateMinDate=function(t,e,i){var n=t.start_date,a=this.config.links;return i.type==a.finish_to_start?n=e.end_date:i.type==a.start_to_start?n=e.start_date:i.type==a.start_to_finish?n=this.calculateEndDate(e.start_date,-1*(t.duration||1)):i.type==a.finish_to_finish&&(n=this.calculateEndDate(e.end_date,-1*t.duration)),
i.lag&&1*i.lag==i.lag&&(n=this.calculateEndDate(n,1*i.lag)),n},t._getTaskMinimalStartDate=function(e){for(var i={},n=0;n<e.$target.length;n++){var a=this.getLink(e.$target[n]),s=this._get_link_source(a);if(s){var r=e,o=s;t._isProject(e)&&(r=t.getSubtaskDates(e.id),r.duration=t.calculateDuration(r.start_date,r.end_date)),t._isProject(s)&&(o=t.getSubtaskDates(s.id),o.duration=t.calculateDuration(o.start_date,o.end_date));var _=t._calculateMinDate(r,o,a);i.date&&!this._firstSmaller(i.date,_)||t._isProject(s)&&t.isChildOf(e.id,s.id)||(i.date=new Date(_),
i.link=a,i.source_task=s)}}return i.date&&this._firstSmaller(e.start_date,i.date)&&(i._mustMove=!0),i},t._getProjectMinimalStartDate=function(e){if(!e)return{};var i;i=t._isProject(e)?t._getTaskMinimalStartDate(e):{};var n;e.parent&&e.parent!=t.config.root_id&&(n=this.getTask(e.parent));var a=t._getProjectMinimalStartDate(n);return(!i.date||a.date&&this._firstSmaller(i.date,a.date))&&(i=a),i},t._autoScheduleParents=function(e,i,n){if(!e||t.config.auto_scheduling_descendant_links)return i;if(e.parent&&e.parent!=t.config.root_id){
var a=this.getTask(e.parent);t._autoScheduleParents(a,i,n)}return t._autoScheduleLinkedTasks(e,i,0,n),i},t._isStrictParent=function(t,e){if(!t)return!1;for(var i;this.getParent(i||t);)if(i=this.getParent(i||t),i==e)return!0;return!1}});
//# sourceMappingURL=../sources/ext/dhtmlxgantt_auto_scheduling.js.map